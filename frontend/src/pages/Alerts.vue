<template>
<div class="fullh fill-height-or-more">

 
  <BaseChart :seriesData="chartData" 
            :labelContent="labelContent" 
            :zoomEnabled="zoomEnabled"
            @selection="getInfo"
            @changedExtremes="sync"
            :extremes="extremes"
            :bands="anoms"
            :activeBand="activeAnom"
            @changeActiveBand="changeActiveAnom"
            :style="{'background-color': 'transparent', 'min-height': '400px'}" />
  
 

<!--  <BaseChart :seriesData="chartData" 
            :labelContent="labelContent" 
            :zoomEnabled="zoomEnabled"
            @selection="getInfo"
            @changedExtremes="sync"
            :extremes="extremes"
            @crosshairMove="syncCrosshairs"
            :crosshair="syncCrosshair"
            :syncCrosshairEnabled="true"
            :style="{'background-color': 'transparent', 'min-height': '400px'}" /> -->

</div>
</template>


<script>
import api from "../api/repository";

import BaseChart from "../components/BaseChart";

export default {
  components: { BaseChart },
  data () {
    return {
      chartData: [],
      popularTags: [],
      zoomEnabled: true,
      extremes: {},
      syncCrosshair: {},
      anoms: [],
      activeAnom: '',
    }
  },
  computed: {
    labelContent() {
      var text = ''
      for (var elem of this.popularTags) {
        text += elem.tag + ': ' + elem.count + ' <br>'
      }
      return text
    }
  },
  methods: {
    sync(event) {
      this.extremes = event
    },
    syncCrosshairs(event) {
      this.syncCrosshair = event
    },
    changeActiveAnom(id) {
      this.activeAnom = id
    },
    getInfo(extremes) {
      api.getTagsCount({
        name: "treetest",
        start: new Date(extremes.min).toISOString(),
        end: new Date(extremes.max).toISOString(),
      })
      .then(response => {       
        this.popularTags = response.data
      })
      .catch(error => { 
        console.log('error')
        console.log(error)
      })
    }
  },
  mounted: function () {

    this.chartData = [ { data: [ [1502222000000, 323], [1505555000000, 222], [1506816000000, 300]] } ,

    { data: [ [1506816000000, 323], [1506902400000, 771], [1506988800000, 722], [1507075200000, 759], [1507161600000, 629], [1507248000000, 540], [1507334400000, 344], [1507420800000, 346], [1507507200000, 644], [1507593600000, 706], [1507680000000, 762], [1507766400000, 453], [1507852800000, 528], [1507939200000, 357], [1508025600000, 460], [1508112000000, 887], [1508198400000, 1123], [1508284800000, 1037], [1508371200000, 759], [1508457600000, 600], [1508544000000, 388], [1508630400000, 442], [1508716800000, 739], [1508803200000, 872], [1508889600000, 807], [1508976000000, 745], [1509062400000, 622], [1509148800000, 396], [1509235200000, 420], [1509321600000, 774], [1509408000000, 819], [1509494400000, 0], [1509580800000, 507], [1509667200000, 595], [1509753600000, 392], [1509840000000, 395], [1509926400000, 824], [1510012800000, 990], [1510099200000, 826], [1510185600000, 655], [1510272000000, 590], [1510358400000, 363], [1510444800000, 346], [1510531200000, 676], [1510617600000, 753], [1510704000000, 611], [1510790400000, 789], [1510876800000, 629], [1510963200000, 425], [1511049600000, 408], [1511136000000, 700], [1511222400000, 910], [1511308800000, 1004], [1511395200000, 838], [1511481600000, 556], [1511568000000, 378], [1511654400000, 378], [1511740800000, 752], [1511827200000, 810], [1511913600000, 812], [1512000000000, 697], [1512086400000, 586], [1512172800000, 407], [1512259200000, 439], [1512345600000, 700], [1512432000000, 775], [1512518400000, 772], [1512604800000, 592], [1512691200000, 461], [1512777600000, 352], [1512864000000, 346], [1512950400000, 702], [1513036800000, 783], [1513123200000, 788], [1513209600000, 666], [1513296000000, 530], [1513382400000, 375], [1513468800000, 389], [1513555200000, 637], [1513641600000, 693], [1513728000000, 688], [1513814400000, 623], [1513900800000, 521], [1513987200000, 417], [1514073600000, 402], [1514160000000, 400], [1514246400000, 655], [1514332800000, 635], [1514419200000, 672], [1514505600000, 622], [1514592000000, 488], [1514678400000, 418], [1514764800000, 458], [1514851200000, 898], [1514937600000, 1096], [1515024000000, 1083], [1515110400000, 941], [1515196800000, 611], [1515283200000, 693], [1515369600000, 1055], [1515456000000, 978], [1515542400000, 879], [1515628800000, 778], [1515715200000, 773], [1515801600000, 558], [1515888000000, 570], [1515974400000, 967], [1516060800000, 912], [1516147200000, 872], [1516233600000, 876], [1516320000000, 673], [1516406400000, 541], [1516492800000, 600], [1516579200000, 954], [1516665600000, 937], [1516752000000, 857], [1516838400000, 813], [1516924800000, 689], [1517011200000, 552], [1517097600000, 577], [1517184000000, 938], [1517270400000, 954], [1517356800000, 881], [1517443200000, 793], [1517529600000, 713], [1517616000000, 469], [1517702400000, 466], [1517788800000, 758], [1517875200000, 784], [1517961600000, 773], [1518048000000, 619], [1518134400000, 542], [1518220800000, 348], [1518307200000, 340], [1518393600000, 441], [1518480000000, 459], [1518566400000, 719], [1518652800000, 1011], [1518739200000, 1016], [1518825600000, 579], [1518912000000, 590], [1518998400000, 876], [1519084800000, 838], [1519171200000, 767], [1519257600000, 655], [1519344000000, 598], [1519430400000, 377], [1519516800000, 412], [1519603200000, 715], [1519689600000, 780], [1519776000000, 802], [1519862400000, 696], [1519948800000, 609], [1520035200000, 416], [1520121600000, 389], [1520208000000, 620], [1520294400000, 741], [1520380800000, 695], [1520467200000, 616], [1520553600000, 585], [1520640000000, 351], [1520726400000, 396], [1520812800000, 668], [1520899200000, 762], [1520985600000, 699], [1521072000000, 623], [1521158400000, 537], [1521244800000, 356], [1521331200000, 433], [1521417600000, 783], [1521504000000, 880], [1521590400000, 817], [1521676800000, 717], [1521763200000, 600], [1521849600000, 426], [1521936000000, 441], [1522022400000, 789], [1522108800000, 859], [1522195200000, 845], [1522281600000, 644], [1522368000000, 394], [1522454400000, 405], [1522540800000, 375], [1522627200000, 800], [1522713600000, 1042], [1522800000000, 880], [1522886400000, 732], [1522972800000, 590], [1523059200000, 357], [1523145600000, 339], [1523232000000, 682], [1523318400000, 597], [1523404800000, 786], [1523491200000, 689], [1523577600000, 595], [1523664000000, 423], [1523750400000, 437], [1523836800000, 719], [1523923200000, 826], [1524009600000, 860], [1524096000000, 726], [1524182400000, 575], [1524268800000, 393], [1524355200000, 434], [1524441600000, 713], [1524528000000, 876], [1524614400000, 993], [1524700800000, 792], [1524787200000, 681], [1524873600000, 419], [1524960000000, 418], [1525046400000, 613], [1525132800000, 599], [1525219200000, 946], [1525305600000, 1104], [1525392000000, 840], [1525478400000, 473], [1525564800000, 421], [1525651200000, 708], [1525737600000, 781], [1525824000000, 836], [1525910400000, 622], [1525996800000, 492], [1526083200000, 367], [1526169600000, 308], [1526256000000, 667], [1526342400000, 615], [1526428800000, 473], [1526515200000, 426], [1526601600000, 395], [1526688000000, 254], [1526774400000, 238], [1526860800000, 440], [1526947200000, 510], [1527033600000, 552], [1527120000000, 484], [1527206400000, 424], [1527292800000, 294], [1527379200000, 277], [1527465600000, 523], [1527552000000, 652], [1527638400000, 588], [1527724800000, 401], [1527811200000, 423], [1527897600000, 290], [1527984000000, 290], [1528070400000, 550], [1528156800000, 678], [1528243200000, 608], [1528329600000, 485], [1528416000000, 379], [1528502400000, 235], [1528588800000, 290], [1528675200000, 457], [1528761600000, 517], [1528848000000, 494], [1528934400000, 449], [1529020800000, 336], [1529107200000, 262], [1529193600000, 248], [1529280000000, 489], [1529366400000, 487], [1529452800000, 487], [1529539200000, 452], [1529625600000, 354], [1529712000000, 288], [1529798400000, 306], [1529884800000, 509], [1529971200000, 548], [1530057600000, 481], [1530144000000, 571], [1530230400000, 442], [1530316800000, 328], [1530403200000, 289], [1530489600000, 515], [1530576000000, 613], [1530662400000, 619], [1530748800000, 525], [1530835200000, 403], [1530921600000, 347], [1531008000000, 346], [1531094400000, 567], [1531180800000, 647], [1531267200000, 733], [1531353600000, 672], [1531440000000, 553], [1531526400000, 416], [1531612800000, 388], [1531699200000, 618], [1531785600000, 682], [1531872000000, 587], [1531958400000, 693], [1532044800000, 584], [1532131200000, 404], [1532217600000, 417], [1532304000000, 753], [1532390400000, 783], [1532476800000, 781], [1532563200000, 741], [1532649600000, 564], [1532736000000, 440], [1532822400000, 366], [1532908800000, 828], [1532995200000, 883], [1533081600000, 724], [1533168000000, 571], [1533254400000, 497], [1533340800000, 266], [1533427200000, 280], [1533513600000, 515], [1533600000000, 346], [1533686400000, 236], [1533772800000, 200], [1533859200000, 170], [1533945600000, 126], [1534032000000, 121], [1534118400000, 242], [1534204800000, 263], [1534291200000, 214], [1534377600000, 219], [1534464000000, 184], [1534550400000, 128], [1534636800000, 91], [1534723200000, 223], [1534809600000, 236], [1534896000000, 242], [1534982400000, 190], [1535068800000, 180], [1535155200000, 105], [1535241600000, 107], [1535328000000, 220], [1535414400000, 233], [1535500800000, 240], [1535587200000, 182], [1535673600000, 170], [1535760000000, 144], [1535846400000, 138], [1535932800000, 193], [1536019200000, 245], [1536105600000, 201], [1536192000000, 181], [1536278400000, 101], [1536364800000, 99], [1536451200000, 108], [1536537600000, 241], [1536624000000, 323], [1536710400000, 294], [1536796800000, 219], [1536883200000, 203], [1536969600000, 112], [1537056000000, 107], [1537142400000, 253], [1537228800000, 241], [1537315200000, 258], [1537401600000, 216], [1537488000000, 201], [1537574400000, 133], [1537660800000, 136], [1537747200000, 287], [1537833600000, 246], [1537920000000, 287], [1538006400000, 276], [1538092800000, 225], [1538179200000, 126], [1538265600000, 123], [1538352000000, 235], [1538438400000, 271], [1538524800000, 270], [1538611200000, 237], [1538697600000, 205], [1538784000000, 107], [1538870400000, 122], [1538956800000, 223], [1539043200000, 228], [1539129600000, 227], [1539216000000, 233], [1539302400000, 164], [1539388800000, 151], [1539475200000, 131], [1539561600000, 259], [1539648000000, 289], [1539734400000, 305], [1539820800000, 302], [1539907200000, 205], [1539993600000, 135], [1540080000000, 126], [1540166400000, 239], [1540252800000, 285], [1540339200000, 320], [1540425600000, 253], [1540512000000, 211], [1540598400000, 149], [1540684800000, 116], [1540771200000, 236], [1540857600000, 254], [1540944000000, 30]]} ,

      

    ]


    this.anoms = [{"id": "1", "from": 1509667200000, "to": 1511568000000, "score": 70}, {"id": "2", "from": 1514764800000, "to": 1514851200000 , "score": 50 }, {"id": "3", "from": 1519171200000, "to": 1525478400000 , "score": 100}, {"id": "4", "from": 1530576000000 , "to": 1533168000000, "score": 25 }, {"id": "5", "from": 1539561600000 , "to": 1540339200000 , "score": 10}]

   /* api.getSeriesData({ 
        name: "treetest",
      })
      .then(response => {       
        this.chartData = response.data
      })
      .catch(error => { 
        console.log('error')
        console.log(error)
      }) */
  },
  created() {
    window.addEventListener('keydown', (e) => {
      if (e.key == 'Control') {
        this.zoomEnabled = !this.zoomEnabled;
      }
    });
  },
}

</script>


<style>
.fullh {
  height: calc(100vh - 3.5rem);
  min-height: calc(100vh - 3.5rem);
}
  
.fill-height-or-more {
  display: flex;
  flex-direction: column;
}

.fill-height-or-more > * {
  flex: 1;
}

</style>